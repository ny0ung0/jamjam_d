<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>공고 리스트</title>
<script src="https://code.jquery.com/jquery-3.7.1.js"
	integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
	crossorigin="anonymous"></script>
</head>

<body>
	<script>
	$(document).ready(function () {
        fetchUserInfo();
    });
	
	function formatDate(dateString) {
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = ('0' + (date.getMonth() + 1)).slice(-2);
        const day = ('0' + date.getDate()).slice(-2);
        return `${year}-${month}-${day}`;
    }
	
	
	function fetchUserInfo() {
        $.ajax({
            url: "http://localhost:8888/userInfo",
            method: "GET",
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                if (data && data.email) {
                	listPost();
                } else {
                    window.location.href = "/nindex";
                }
            },
            error: function () {
                alert('사용자 정보를 가져오는 중 오류가 발생했습니다.');
            }
        });
    }
	
	function listPost() {
        $.ajax({
            url: `http://localhost:8888/user/jobPosts`,
            method: "GET",
            success: function (data) {
                const tableBody = $('#postListTable tbody');
                tableBody.empty();
                if (data.length > 0) {
                    data.forEach(post => {
                        const row = `<tr>
                            <td><a href="/company/job_posting_detail_company?posting_id=${post.posting_id}">${post.title}</a></td>
                            <td>${formatDate(post.application_deadline)}</td>
                        </tr>`;
                        tableBody.append(row);
                    });
                } else {
                    const row = '<tr><td colspan="2">작성된 이력서가 없습니다.</td></tr>';
                    tableBody.append(row);
                }
            },
            error: function () {
                alert('이력서 리스트를 가져오는 중 오류가 발생했습니다.');
            }
        });
    }
	</script>
	<div id="postListContainer">
		<table id="postListTable">
			<thead>
				<tr>
					<th>공고 제목</th>
					<th>마감 날짜</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
</body>
</html>